# نظام ترتيب الجداول التدريبية

تطبيق ويب مبني بإطار **Flask** لتجميع بيانات المدربين والمواد من ملف Excel ثم إنشاء جدول أسبوعي تلقائيًا بين الأحد والخميس. التطبيق يستخدم **SQLite** للتخزين و **SQLAlchemy** كطبقة ORM، مع إمكانية رفع ملف Excel (أعمدة: المدرب، المادة، الساعات المطلوبة) وتشغيل خوارزمية توزع الحصص حسب النصاب الأسبوعي لكل مدرب.

## المزايا

- رفع ملفات Excel وتحويلها تلقائيًا إلى بيانات مدربين ومواد (مع قالب جاهز للتنزيل) مع تحديد عدد الحصص اليومية لكل مادة.
- تعريف النصاب الأسبوعي لكل مدرب (ساعة = 50 دقيقة) مع توزيع الحصص تلقائيًا.
- عرض الجدول الزمني بحسب الأيام باستخدام واجهة عربية تعتمد Bootstrap.
- استعراض جدول خاص لكل مدرب لمعرفة حصصه اليومية بسهولة.
- إضافة أو تعديل الحصص يدويًا مع اختيار اليوم، الزمن، المدرب، الشعبة، والمدة مباشرة من الواجهة.
- تصدير الجدول الناتج مرة أخرى إلى ملف Excel.
- تنزيل جدول مستقل لكل مدرب على حدة.
- تشغيل فحص تعارضات يعرض أي تداخل زمني أو ازدواج مدربين في نفس الفترة.
- زر لمسح قاعدة البيانات بالكامل من داخل الواجهة (مع تأكيد مسبق).
- تخزين البيانات محليًا في قاعدة SQLite قابلة للمشاركة.

## المتطلبات

- Python 3.10 أو أحدث.
- المكتبات المذكورة في `requirements.txt`:
  - Flask
  - Flask-SQLAlchemy
  - SQLAlchemy
  - pandas
  - openpyxl

## التثبيت والتشغيل

```pwsh
cd training_schedule
python -m venv .venv
.\.venv\Scripts\Activate.ps1
pip install -r requirements.txt
python app.py
```

بعد التشغيل، افتح المتصفح على `http://127.0.0.1:5000` لرفع ملف Excel وتشغيل الجدولة التلقائية.

### استيراد البيانات

1. حمّل القالب الجاهز عبر زر **"تحميل قالب Excel"** في الصفحة الرئيسية أو استخدم الملف الموجود في `sample_data/trainers_template.xlsx`.
2. عدّل القالب بإضافة المدربين والمواد والساعات المطلوبة لكل مادة، ويمكنك تعبئة عمود **الحصص اليومية** لتحديد عدد الحصص المتتالية المسموح بها للمادة في اليوم (الافتراضي 1).
3. ارفع الملف باستخدام نموذج "رفع ملف Excel"، وستُحدَّث قاعدة البيانات تلقائيًا.
4. بعد الاستيراد يمكن تعديل **الحصص اليومية** لكل مادة من الجدول في الواجهة مباشرةً.

### تعديل الجدول يدويًا

- استخدم زر **"إضافة حصة يدوية"** في لوحة الأدوات لفتح نافذة إدخال حصة جديدة، أو زر **"تحرير"** بجانب أي حصة قائمة.
- يمكن تعديل المادة، المدرب، اليوم، وقت البداية، مدة الحصة (بعدد الحصص المتتالية)، بالإضافة إلى حقل **الشعبة** ليعكس الفصل أو المجموعة.
- النظام يتحقق من التعارضات الزمنية قبل الحفظ، ويمنع تداخل الحصص أو تكرار المدرب في الوقت نفسه.

### تصدير الجدول

بعد إنشاء جدول تلقائي، استخدم زر **"تصدير الجدول إلى Excel"** لتحميل ملف يحتوي على الأيام، الأوقات، المواد، والمدربين.
كما يمكن تحميل جدول كل مدرب من زر **"تحميل"** الموجود بجانب اسمه.

### كشف التعارضات

- يعرض قسم "التعارضات المكتشفة" أي حصص متداخلة زمنيًا أو مدرب مكرر في نفس الوقت.
- اضغط زر **"تعديل الحصة الأولى"** ضمن كل تعارض للانتقال مباشرةً إلى نافذة التعديل ومعالجة المشكلة.

### إعادة تهيئة البيانات

- استخدم زر **"مسح جميع البيانات"** لإرجاع النظام إلى حالته الفارغة (يحذف المدربين والمواد والجدول).
- سيُطلب منك تأكيد العملية قبل التنفيذ لتجنب المسح عن طريق الخطأ.

## بنية الملف

```
training_schedule/
├── app.py            # نقطة تشغيل Flask والواجهات
├── models.py         # تعريف جداول قاعدة البيانات
├── scheduler.py      # خوارزمية توزيع الحصص
├── templates/
│   └── index.html    # واجهة المستخدم الرئيسية
├── static/
│   ├── style.css
│   └── script.js
├── sample_data/
│   └── trainers_template.xlsx
├── database/
│   └── schedule.db   # يتم إنشاؤه تلقائيًا عند التشغيل
├── uploads/          # تخزين مؤقت لملفات Excel
└── requirements.txt
```

## تنسيق ملف Excel المدعوم

| المدرب | المادة | الساعات المطلوبة | الحصص اليومية |
|--------|--------|-------------------|----------------|
| أحمد   | رياضيات | 6 | 2 |
| سارة   | كيمياء  | 8 | 2 |

- يمكن أن يحتوي الملف على صفوف متعددة لنفس المدرب أو المادة.
- يتم إنشاء المواد والمدربين تلقائيًا إذا لم يكونوا موجودين مسبقًا.
- يتم تحديث النصاب الأسبوعي للمدرب بناءً على إجمالي الساعات الخاصة به في الملف.
- يتم ضبط عدد الحصص اليومية للمادة بناءً على العمود المخصص أو من خلال واجهة التطبيق.
- يمكن تحديد الشعبة لكل حصة عبر نافذة التحرير اليدوي.

## تطوير مستقبلي مقترح

- تصدير الجدول النهائي إلى ملف Excel أو PDF.
- إضافة محرر يدوي للحصص داخل المتصفح.
- دعم تحديد فترات زمنية مختلفة أو عدد حصص مرن خلال اليوم.
